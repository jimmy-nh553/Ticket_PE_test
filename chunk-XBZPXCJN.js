import{a as pe,b as de,c as ce,d as ge,e as ue,f as fe}from"./chunk-5WBRXMTE.js";import{a as re,b as oe,c as ae,d as le,e as me}from"./chunk-N37AEC6R.js";import"./chunk-7ISU4VHZ.js";import{a as se}from"./chunk-U7BT5TPS.js";import"./chunk-L4T4O7BY.js";import"./chunk-CNDIVVUN.js";import{k as ie,l as ne}from"./chunk-MDFODGFC.js";import{b as te,c as N}from"./chunk-YXGW5C3D.js";import"./chunk-45ZPYATT.js";import{b as E}from"./chunk-2XU7JKIX.js";import{a as ee}from"./chunk-GVESCPSC.js";import{d as Y,g as Z,j as $}from"./chunk-X5WX7QWY.js";import"./chunk-RPLDP4LT.js";import"./chunk-VCLJSZIP.js";import{f as X,g as k}from"./chunk-HEYRUS75.js";import"./chunk-X2Y62DJS.js";import"./chunk-JBR4PRVN.js";import"./chunk-WPZQ3JMC.js";import"./chunk-NLBVP2SK.js";import{$ as Q,U as D}from"./chunk-XDDGYLIL.js";import"./chunk-4YRY4IP2.js";import{k as G,q,s as J,t as K,u as I}from"./chunk-VDAMAAAC.js";import{$a as t,Aa as S,Ab as u,Bb as U,Cb as w,Db as b,Eb as R,Mb as P,Oa as C,Ob as z,Pb as A,Ra as p,Ua as j,W as x,Wa as v,ab as i,bb as _,ca as O,da as T,ea as y,fb as H,j as W,jb as f,ka as V,kb as M,t as B,ub as n,v as L,wb as d,yb as c,za as m,zb as g}from"./chunk-K5RBF46N.js";import"./chunk-4CLCTAJ7.js";var be=()=>({width:"50rem"}),Te=()=>({"1199px":"75vw","575px":"90vw"}),ye=()=>["itemNo","itemName"],Se=a=>({"bg-slate-400 hover:bg-slate-400":a}),F=class a{constructor(o){this.confirmationService=o}_visible=!1;get visible(){return this._visible}visibleChange=new V;set visible(o){this._visible=o,this.visibleChange.emit(o)}title="";minDate=new Date;mode="create";prize={no:"",itemNo:"",itemName:"",imageUrl:"",itemPrice:0,profitPercentage:0,totalIncProfit:0,ticketPrice:0,ticketsTotal:0,ticketsProgress:0,isFinished:!1,winnerName:"",winnerDoc:"",startDateTime:new Date,finishDateTime:void 0,itemObj:{itemNo:"",itemName:"",imageUrl:"",itemPrice:0}};items=[];ngOnChanges(o){o.mode&&this.setTitle()}ngOnInit(){this.setTitle()}setTitle(){if(this.mode==="create"){this.title="Crear sorteo";return}this.title=`Sorteo ${this.prize.no}`}priceSelected(){this.prize.itemNo=this.prize.itemObj.itemNo,this.prize.itemName=this.prize.itemObj.itemName,this.prize.itemPrice=this.prize.itemObj.itemPrice,this.prize.imageUrl=this.prize.itemObj.imageUrl,this.prize.totalIncProfit=this.prize.itemPrice,this.calculateTotalIncProfit(),this.calculateTotalTickets()}calculateTotalIncProfit(){let o=this.prize.profitPercentage/100;this.prize.totalIncProfit=this.prize.itemPrice+this.prize.itemPrice*o}calculateTotalTickets(){if(this.prize.ticketPrice>0){this.prize.ticketsTotal=this.prize.totalIncProfit/this.prize.ticketPrice;return}this.prize.ticketsTotal=0}calculateTicketPrice(){if(this.prize.ticketsTotal>0){this.prize.ticketPrice=this.prize.totalIncProfit/this.prize.ticketsTotal;return}this.prize.ticketPrice=0}convertPorcentageToDecimal(o){return o/100}toggleVisibility(){this.visible=!this.visible,this.clearInputs()}dataIsInvalid(){return this.prize.itemNo.trim().length===0||this.prize.itemName.trim().length===0||this.prize.itemPrice<=0||this.prize.profitPercentage<0||this.prize.totalIncProfit<=0||this.prize.ticketPrice<=0||this.prize.ticketsTotal<=0||!this.prize.startDateTime}savePrize(){this.toggleVisibility()}clearInputs(){this.prize={no:"",itemNo:"",itemName:"",imageUrl:"",itemPrice:0,profitPercentage:0,totalIncProfit:0,ticketPrice:0,ticketsTotal:0,ticketsProgress:0,isFinished:!1,winnerName:"",winnerDoc:"",startDateTime:new Date,finishDateTime:void 0,itemObj:{itemNo:"",itemName:"",imageUrl:"",itemPrice:0}}}createConfirm(o){this.confirmationService.confirm({target:o.target,message:`\xBFEst\xE1 seguro que desea crear el sorteo para el item ${this.prize.itemName}?`,header:"Confirmaci\xF3n",closable:!0,closeOnEscape:!0,icon:"pi pi-exclamation-triangle",rejectButtonProps:{label:"Cancelar",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Crear"},accept:()=>{this.savePrize()},reject:()=>{}})}static \u0275fac=function(l){return new(l||a)(S(D))};static \u0275cmp=x({type:a,selectors:[["admin-modal-prize"]],inputs:{visible:"visible",mode:"mode",prize:"prize",items:"items"},outputs:{visibleChange:"visibleChange"},standalone:!0,features:[U([D]),O,w],decls:34,vars:39,consts:[[3,"visibleChange","onHide","header","modal","visible","breakpoints"],[1,"grid","grid-cols-12","gap-4","mt-4"],[1,"flex","flex-col","col-span-12","md:col-span-6"],["for","txtName",1,"text-sm","text-slate-500","font-medium","mb-2"],["placeholder","Seleccione","optionLabel","itemName",1,"w-full",3,"ngModelChange","onChange","options","ngModel","filter","filterFields"],["inputId","txtItemPrice","mode","decimal",3,"ngModelChange","ngModel","minFractionDigits","maxFractionDigits","disabled"],["inputId","txtProfitPercentage","suffix","%","mode","decimal",3,"ngModelChange","ngModel","minFractionDigits","maxFractionDigits"],["for","txtTotalIncProfit",1,"text-sm","text-slate-500","font-medium","mb-2"],["inputId","txtTotalIncProfit","mode","decimal",3,"ngModelChange","ngModel","disabled","minFractionDigits","maxFractionDigits"],["for","txtTicketPrice",1,"text-sm","text-slate-500","font-medium","mb-2"],["inputId","txtTicketPrice","mode","decimal",3,"ngModelChange","ngModel","minFractionDigits","maxFractionDigits"],["for","txtTicketsTotal",1,"text-sm","text-slate-500","font-medium","mb-2"],["inputId","txtTicketsTotal",3,"ngModelChange","ngModel"],["for","txtStartDateTime",1,"text-sm","text-slate-500","font-medium","mb-2"],["inputId","txtStartDateTime","styleClass","w-full","placeholder","dd/mm/yyyy","dateFormat","dd/mm/yy","appendTo","body",3,"ngModelChange","ngModel","iconDisplay","showIcon","minDate","showTime","hourFormat"],[1,"text-center","my-4"],[1,"rounded-xl","font-semibold","shadow-lg","bg-red-500","text-white","px-4","py-1","transition","duration-300","ease-in-out","hover:bg-red-600",3,"click","disabled","ngClass"]],template:function(l,e){l&1&&(t(0,"p-dialog",0),u("visibleChange",function(r){return g(e.visible,r)||(e.visible=r),r}),f("onHide",function(){return e.clearInputs()}),t(1,"div",1)(2,"div",2)(3,"label",3),n(4,"Item:"),i(),t(5,"p-select",4),u("ngModelChange",function(r){return g(e.prize.itemObj,r)||(e.prize.itemObj=r),r}),f("onChange",function(){return e.priceSelected()}),i()(),t(6,"div",2)(7,"label",3),n(8,"Costo item:"),i(),t(9,"p-inputnumber",5),u("ngModelChange",function(r){return g(e.prize.itemPrice,r)||(e.prize.itemPrice=r),r}),i()(),t(10,"div",2)(11,"label",3),n(12,"Porcentaje de ganancia:"),i(),t(13,"p-inputnumber",6),u("ngModelChange",function(r){return g(e.prize.profitPercentage,r)||(e.prize.profitPercentage=r),r}),f("ngModelChange",function(){return e.calculateTotalIncProfit()}),i()(),t(14,"div",2)(15,"label",7),n(16,"Total:"),i(),t(17,"p-inputnumber",8),u("ngModelChange",function(r){return g(e.prize.totalIncProfit,r)||(e.prize.totalIncProfit=r),r}),i()(),t(18,"div",2)(19,"label",9),n(20,"Costo de ticket:"),i(),t(21,"p-inputnumber",10),u("ngModelChange",function(r){return g(e.prize.ticketPrice,r)||(e.prize.ticketPrice=r),r}),f("ngModelChange",function(){return e.calculateTotalTickets()}),i()(),t(22,"div",2)(23,"label",11),n(24,"Tickets emitidos:"),i(),t(25,"p-inputnumber",12),u("ngModelChange",function(r){return g(e.prize.ticketsTotal,r)||(e.prize.ticketsTotal=r),r}),f("ngModelChange",function(){return e.calculateTicketPrice()}),i()(),t(26,"div",2)(27,"label",13),n(28,"Fecha y hora de inicio:"),i(),t(29,"p-datepicker",14),u("ngModelChange",function(r){return g(e.prize.startDateTime,r)||(e.prize.startDateTime=r),r}),i()()(),t(30,"div",15)(31,"button",16),f("click",function(r){return e.createConfirm(r)}),n(32),i()()(),_(33,"p-confirmdialog")),l&2&&(j(b(34,be)),p("header",e.title)("modal",!0),c("visible",e.visible),p("breakpoints",b(35,Te)),m(5),p("options",e.items),c("ngModel",e.prize.itemObj),p("filter",!0)("filterFields",b(36,ye)),m(4),c("ngModel",e.prize.itemPrice),p("minFractionDigits",2)("maxFractionDigits",2)("disabled",!0),m(4),c("ngModel",e.prize.profitPercentage),p("minFractionDigits",2)("maxFractionDigits",2),m(4),c("ngModel",e.prize.totalIncProfit),p("disabled",!0)("minFractionDigits",2)("maxFractionDigits",2),m(4),c("ngModel",e.prize.ticketPrice),p("minFractionDigits",2)("maxFractionDigits",2),m(4),c("ngModel",e.prize.ticketsTotal),m(4),c("ngModel",e.prize.startDateTime),p("iconDisplay","input")("showIcon",!0)("minDate",e.minDate)("showTime",!0)("hourFormat","24"),m(2),p("disabled",e.dataIsInvalid())("ngClass",R(37,Se,e.dataIsInvalid())),m(),d(" ",e.mode==="edit"?"Guardar":"Crear sorteo"," "))},dependencies:[I,G,$,Y,Z,k,N,te,E,ne,ie,ce,de,oe,re,ue,ge]})};var ve=()=>({"min-width":"45rem"});function Me(a,o){a&1&&(t(0,"tr")(1,"th",11),n(2," N\xB0 Sorteo "),i(),t(3,"th",11),n(4," N\xB0 Item "),i(),t(5,"th",11),n(6," Item "),i(),t(7,"th",12),n(8," Costo Item "),i(),t(9,"th",13),n(10," Procentaje Ganancia "),i(),t(11,"th",13),n(12," Total inc/ganancia "),i(),t(13,"th",11),n(14," Precio Ticket "),i(),t(15,"th",11),n(16," Total Tickets "),i(),t(17,"th",11),n(18," Tickets Comprados "),i(),t(19,"th",11),n(20," Finalizado "),i(),t(21,"th",11),n(22," DNI Ganador "),i(),t(23,"th",11),n(24," Ganador "),i(),t(25,"th",11),n(26," Fecha Inicio "),i(),t(27,"th",11),n(28," Fecha Sorteo "),i()())}function xe(a,o){a&1&&_(0,"span",17)}function we(a,o){a&1&&_(0,"span",18)}function Ie(a,o){if(a&1&&n(0),a&2){let l=M().$implicit;d(" ",l.winnerDoc," ")}}function De(a,o){a&1&&_(0,"span",19)}function ke(a,o){if(a&1&&n(0),a&2){let l=M().$implicit;d(" ",l.winnerName," ")}}function Ee(a,o){a&1&&_(0,"span",19)}function Ne(a,o){if(a&1&&(n(0),P(1,"date")),a&2){let l=M().$implicit;d(" ",z(1,1,l.finishDateTime,"dd/MM/yyyy HH:mm:ss")," ")}}function Fe(a,o){a&1&&_(0,"span",20)}function We(a,o){if(a&1&&(t(0,"tr",14)(1,"td",15),n(2),i(),t(3,"td",15),n(4),i(),t(5,"td",15),n(6),i(),t(7,"td",15),n(8),P(9,"currency"),i(),t(10,"td",15),n(11),P(12,"percent"),i(),t(13,"td",15),n(14),P(15,"currency"),i(),t(16,"td",15),n(17),P(18,"currency"),i(),t(19,"td",15),n(20),i(),t(21,"td",15),n(22),i(),t(23,"td",16),C(24,xe,1,0,"span",17)(25,we,1,0,"span",18),i(),t(26,"td",15),C(27,Ie,1,1)(28,De,1,0,"span",19),i(),t(29,"td",15),C(30,ke,1,1)(31,Ee,1,0,"span",19),i(),t(32,"td",15),n(33),P(34,"date"),i(),t(35,"td",15),C(36,Ne,2,4)(37,Fe,1,0,"span",20),i()()),a&2){let l=o.$implicit,e=M();p("pSelectableRow",l),m(2),d(" ",l.no," "),m(2),d(" ",l.itemNo," "),m(2),d(" ",l.itemName," "),m(2),d(" ",z(9,15,l.itemPrice,"S/ ")," "),m(3),d(" ",z(12,18,e.convertPorcentageToDecimal(l.profitPercentage),"1.2-2")," "),m(3),d(" ",z(15,21,l.totalIncProfit,"S/ ")," "),m(3),d(" ",z(18,24,l.ticketPrice,"S/ ")," "),m(3),d(" ",l.ticketsTotal," "),m(2),d(" ",l.ticketsProgress," "),m(2),v(l.isFinished?24:25),m(3),v(l.winnerDoc.trim().length>0?27:28),m(3),v(l.winnerName.trim().length>0?30:31),m(3),d(" ",z(34,27,l.startDateTime,"dd/MM/yyyy HH:mm:ss")," "),m(3),v(l.finishDateTime?36:37)}}function Le(a,o){a&1&&(t(0,"tr")(1,"td",21),n(2,"No se encontraron registros."),i()())}var _e=class a{constructor(o,l){this._prizeService=o;this._itemsService=l}modalVisible=!1;modalMode="create";selectedPrize={no:"",itemNo:"",itemName:"",imageUrl:"",itemPrice:0,profitPercentage:0,totalIncProfit:0,ticketPrice:0,ticketsTotal:0,ticketsProgress:0,isFinished:!1,winnerName:"",winnerDoc:"",startDateTime:new Date,finishDateTime:void 0,itemObj:{itemNo:"",itemName:"",imageUrl:"",itemPrice:0}};prizes=[];items=[];ngOnInit(){this.getData()}getData(){B({prizes:this._prizeService.getAllAdmin().pipe(L(()=>W(null))),items:this._itemsService.getAll().pipe(L(()=>W(null)))}).subscribe(o=>{this.prizes=o.prizes||[],this.items=o.items||[]},o=>{console.error("Error loading data",o)})}convertPorcentageToDecimal(o){return o/100}newPrize(){this.selectedPrize={no:"",itemNo:"",itemName:"",imageUrl:"",itemPrice:0,profitPercentage:0,totalIncProfit:0,ticketPrice:0,ticketsTotal:0,ticketsProgress:0,isFinished:!1,winnerName:"",winnerDoc:"",startDateTime:new Date,finishDateTime:void 0,itemObj:{itemNo:"",itemName:"",imageUrl:"",itemPrice:0}},this.modalMode="create",this.toggleVisibility()}toggleVisibility(){this.modalVisible=!this.modalVisible}showModal(){this.modalMode="edit",this.toggleVisibility()}static \u0275fac=function(l){return new(l||a)(S(ee),S(fe))};static \u0275cmp=x({type:a,selectors:[["app-admin-prizes-list-page"]],standalone:!0,features:[w],decls:15,vars:10,consts:[["header",""],["body",""],[1,"mx-auto","max-w-[1500px]"],[1,"mx-8"],[1,"my-3","flex","justify-between"],[1,"uppercase","font-bold","text-xl"],["label","Nuevo","size","small","severity","info",3,"onClick"],[1,""],["styleClass","text-sm","selectionMode","single","dataKey","no",3,"selectionChange","onRowSelect","value","tableStyle","selection","scrollable","scrollHeight"],["pTemplate","emptymessage"],[3,"visibleChange","visible","prize","mode","items"],[1,"px-1","md:px-3","bg-slate-200",2,"width","10%"],[1,"bg-slate-200",2,"width","15%"],[1,"bg-slate-200",2,"width","10%"],[3,"pSelectableRow"],[1,"px-1","md:px-3"],[1,"px-1","md:px-3","text-center"],[1,"pi","pi-check"],[1,"pi","pi-times"],[1,"pi","pi-minus"],[1,"pi","pi-minus","text-[13px]"],["colspan","14",1,"text-center"]],template:function(l,e){if(l&1){let s=H();_(0,"admin-header"),t(1,"section",2)(2,"div",3)(3,"div",4)(4,"h1",5),n(5,"Sorteos"),i(),t(6,"p-button",6),f("onClick",function(){return T(s),y(e.newPrize())}),i()(),t(7,"div",7)(8,"p-table",8),u("selectionChange",function(h){return T(s),g(e.selectedPrize,h)||(e.selectedPrize=h),y(h)}),f("onRowSelect",function(){return T(s),y(e.showModal())}),C(9,Me,29,0,"ng-template",null,0,A)(11,We,38,30,"ng-template",null,1,A)(13,Le,3,0,"ng-template",9),i()()()(),t(14,"admin-modal-prize",10),u("visibleChange",function(h){return T(s),g(e.modalVisible,h)||(e.modalVisible=h),y(h)}),i()}l&2&&(m(8),p("value",e.prizes)("tableStyle",b(9,ve)),c("selection",e.selectedPrize),p("scrollable",!0)("scrollHeight","flex"),m(6),c("visible",e.modalVisible),p("prize",e.selectedPrize)("mode",e.modalMode)("items",e.items))},dependencies:[I,J,K,q,se,me,ae,Q,le,k,X,N,E,pe,F]})};export{_e as AdminPrizesListPageComponent};
